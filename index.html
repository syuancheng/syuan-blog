<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="KEEP CALM AND CARRY ON Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="KEEP CALM AND CARRY ON Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-51754530-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">KEEP CALM AND CARRY ON | KEEP CALM AND CARRY ON</title><meta data-react-helmet="true" property="og:title" content="KEEP CALM AND CARRY ON | KEEP CALM AND CARRY ON"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="description" content="The blog of syuan"><meta data-react-helmet="true" property="og:description" content="The blog of syuan"><meta data-react-helmet="true" property="og:url" content="https://syuancheng.github.io//"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_posts_list"><meta data-react-helmet="true" property="og:image" content="https://syuancheng.github.io//img/profile.png"><meta data-react-helmet="true" name="twitter:image" content="https://syuancheng.github.io//img/profile.png"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://syuancheng.github.io//"><link data-react-helmet="true" rel="alternate" href="https://syuancheng.github.io//" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://syuancheng.github.io//" hreflang="x-default"><script data-react-helmet="true">function maybeInsertBanner(){window.__DOCUSAURUS_INSERT_BASEURL_BANNER&&insertBanner()}function insertBanner(){var n=document.getElementById("docusaurus-base-url-issue-banner-container");if(n){n.innerHTML='\n<div id="docusaurus-base-url-issue-banner" style="border: thick solid red; background-color: rgb(255, 230, 179); margin: 20px; padding: 20px; font-size: 20px;">\n   <p style="font-weight: bold; font-size: 30px;">Your Docusaurus site did not load properly.</p>\n   <p>A very common reason is a wrong site <a href="https://docusaurus.io/docs/docusaurus.config.js/#baseurl" style="font-weight: bold;">baseUrl configuration</a>.</p>\n   <p>Current configured baseUrl = <span style="font-weight: bold; color: red;">/</span>  (default value)</p>\n   <p>We suggest trying baseUrl = <span id="docusaurus-base-url-issue-banner-suggestion-container" style="font-weight: bold; color: green;"></span></p>\n</div>\n';var e=document.getElementById("docusaurus-base-url-issue-banner-suggestion-container"),s=window.location.pathname,r="/"===s.substr(-1)?s:s+"/";e.innerHTML=r}}window.__DOCUSAURUS_INSERT_BASEURL_BANNER=!0,document.addEventListener("DOMContentLoaded",maybeInsertBanner)</script><link rel="stylesheet" href="/assets/css/styles.e878b9ba.css">
<link rel="preload" href="/assets/js/runtime~main.b919a8d1.js" as="script">
<link rel="preload" href="/assets/js/main.35894529.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div id="docusaurus-base-url-issue-banner-container"></div><div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/profile.jpg" alt="KEEP CALM AND CARRY ON" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/profile.jpg" alt="KEEP CALM AND CARRY ON" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">KEEP CALM AND CARRY ON</b></a><a class="navbar__item navbar__link" href="/about">About</a><a class="navbar__item navbar__link" href="/blog-archive">Blog Archive</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/syuancheng" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/Go module Basic">How to use go Module</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/è®¡ç®—æœºå­¦ä¹ çš„ä¸€äº›æœ‰ç”¨å»ºè®®">è®¡ç®—æœºå­¦ä¹ çš„ä¸€äº›æœ‰ç”¨å»ºè®®</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/Regex Basic">Regex Basic</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/Build blog by Docusaurus and deploy in Git Page">Build blog by Docusaurus and deploy in Git Page</a></li></ul></nav></aside><main class="col col--7"><article class="margin-bottom--xl"><header><h2 class="blogPostTitle_GeHD"><a href="/Go module Basic">How to use go Module</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2022-08-27T00:00:00.000Z">August 27, 2022</time> Â· 7 min read</div><div class="avatar margin-vert--md"><a href="https://github.com/syuancheng" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://raw.githubusercontent.com/syuancheng/images/master/.github/resource/profile_460x460.jpg" alt="Syuan"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/syuancheng" target="_blank" rel="noopener noreferrer">Syuan</a></div><small class="avatar__subtitle">Back End Engineer @ Shopee</small></div></div></header><div class="markdown"><p>It&#x27;s easy to encounter some issues in your dependency management. Go module is a dependencies management tool of golang. Go mod is treated as default dependency management tool from go 1.13. And more and more golang developer start to use the Go module to manage their Go project. Based on this, it&#x27;s necessary to study how to use go mod and how go mod works.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="modules-packages-and-versions"></a>Modules, packages, and versions<a class="hash-link" href="#modules-packages-and-versions" title="Direct link to heading">#</a></h4><ul><li><p><strong>Module</strong>: A module is a collection of packages that are released, versioned, and distributed together, a module is identified by a module path, which is declared in a go.mod file. For example, <a href="https://git.garena.com/shopee/deep/bff-rcmd" target="_blank" rel="noopener noreferrer">https://git.garena.com/shopee/deep/bff-rcmd</a> is a module that have several packages in it, it has a go.mod file, whose first line declared the module path:  module git.garena.com/shopee/deep/bff-rcmd . For example, git.garena.com/shopee-server/merlion-monitor is one package of this module. A repo can contain multiple modules. For example,  although git.garena.com/shopee/deep/mnet/trigger is in a subdirectory of git.garena.com/shopee/deep/mnet, in go module definition the former is not to see a package of latter, because trigger has its own go.mod file to declare itself as a module and provide its dependencies information, it&#x27;s a module what only have one package.</p></li><li><p><strong>Version</strong>: A version identifies an immutable snapshot of a module. For example v1.3.5 and v0.0.0-20210408083853-bea4e61c1705, the former has a semantic version tags but the latter is a pseudo-version, which is compounded of a based version prefix, a timestamp(yyyymmddhhmmssin git it&#x27;s the commit time) and a 12-character prefix of the commit hash.</p></li><li><p><strong>go.mod file</strong>: A module is defined by a UTF-8 encoded text file named go.mod in its root directory. The go.mod file is line-oriented. Each line holds a single directive, made up of a keyword followed by arguments. For example:</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">module example.com/my/thing</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">go 1.12 </span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">require example.com/other/thing v1.0.2</span></span><span class="token-line" style="color:#393A34"><span class="token plain">require example.com/new/thing/v2 v2.3.4</span></span><span class="token-line" style="color:#393A34"><span class="token plain">exclude example.com/old/thing v1.2.3</span></span><span class="token-line" style="color:#393A34"><span class="token plain">replace example.com/bad/thing v1.4.5 =&gt; example.com/good/thing v1.4.5</span></span><span class="token-line" style="color:#393A34"><span class="token plain">retract [v1.9.0, v1.9.5]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="directives-require-go-replace-exclude"></a>Directives require, go, replace, exclude<a class="hash-link" href="#directives-require-go-replace-exclude" title="Direct link to heading">#</a></h4><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="go"></a>go<a class="hash-link" href="#go" title="Direct link to heading">#</a></h5><p>A go directive indicates that a module was written assuming the
semantics of a given version of Go.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="require"></a>require<a class="hash-link" href="#require" title="Direct link to heading">#</a></h5><p>A require directive declares a minimum required version of a given module dependency. For each required module version, the go command loads the go.mod file for that version and incorporates the requirements from that file. Once all requirements have been loaded, the go command resolves them using minimal version selection (MVS) to produce the build list.
The go command automatically adds // indirect comments for some requirements. An // indirect comment indicates that no package from the required module is directly imported by any package in the main module.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="replace"></a>replace<a class="hash-link" href="#replace" title="Direct link to heading">#</a></h5><p>A replace directive replaces the contents of a specific version of a module, or all versions of a module, with contents found elsewhere. The replacement may be specified with either another module path and version, or a platform-specific file path.
If a version is present on the left side of the arrow (=&gt;), only that specific version of the module is replaced; other versions will be accessed normally. If the left version is omitted, all versions of the module are replaced.
If the path on the right side of the arrow is an absolute or relative path (beginning with ./ or ../), it is interpreted as the local file path to the replacement module root directory, which must contain a go.mod file. The replacement version must be omitted in this case.
If the path on the right side is not a local path, it must be a valid module path. In this case, a version is required. The same module version must not also appear in the build list.
Regardless of whether a replacement is specified with a local path or module path, if the replacement module has a go.mod file, its module directive must match the module path it replaces.
replace directives only apply in the main moduleâ€™s go.mod file and are ignored in other modules. See Minimal version selection for details.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="exclude"></a>exclude<a class="hash-link" href="#exclude" title="Direct link to heading">#</a></h5><p>An exclude directive prevents a module version from being loaded by the go command.
Since Go 1.16, if a version referenced by a require directive in any go.mod file is excluded by an exclude directive in the main moduleâ€™s go.mod file, the requirement is ignored. This may cause commands like go get and go mod tidy to add new requirements on higher versions to go.mod, with an // indirect comment if appropriate.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="solve-backward-incompatibility"></a>Solve backward incompatibility<a class="hash-link" href="#solve-backward-incompatibility" title="Direct link to heading">#</a></h4><p>As shown below, the main module requires 1.2 version of module A and 1.x version of module B, but module B  requires 1.1 version of module A. This situation appears commonly. Of course, module A 1.2 was chosen, because it&#x27;s the highest version of all required versions.
<img alt="image" src="/assets/images/gomod1-e1e65a99c27aa8233370b6913ce7652b.png"></p><p>In the ideal situation, version should be backward compatibility, so choosing the highest version has no problem. But usually the backward compatibility is not satisfied in most modules . For example, the new version may change the signature of function, modules that use the old version will fail in building because function calling in the module does not fit to the new function signature. These are several solutions:</p><ol><li>Update codes in every module which depended on that module to fit in the highest version. In this case, you should update module B code to depend on A 1.2. This is only available when you can do all of the updating and you need the new feature in the highest version.</li><li>Find an old version or commit that satisfying all modules, use go get to downgrade to that version. For example, you find that v1.2.0 satisfying all modules, you can run &#x27;go get &lt;module_name&gt;@v1.2.0&#x27;, or you find that a commit satisfying all modules, you can run &#x27;go get &lt;module_name&gt;@&lt;first 12 chars of the commit hash&gt;&#x27;. This is only available when you don&#x27;t need the new features of the highest version.</li><li>Find an old version that satisfying all module and add &#x27;replace&#x27; directive to appoint that version in go.mod file. You can see some &#x27;replace&#x27; in the go.mod file show above. This is not recommended if you can solve the conflict in the above two ways. And this solution is also only available when you don&#x27;t need the new features of the highest version.</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="start-to-use-go-mod"></a>Start to use go mod<a class="hash-link" href="#start-to-use-go-mod" title="Direct link to heading">#</a></h4><ol><li>go mod init &lt;your module name, for example git.garena.com/zhaozw/cgzip&gt; (create a go.mod file that contains module name)</li><li>go mod tidy (to add requires in go.mod file)</li></ol><blockquote><p>go mod tidy ensures that the go.mod file matches the source code in the module. It adds any missing module requirements necessary to build the current moduleâ€™s packages and dependencies, and it removes requirements on modules that donâ€™t provide any relevant packages. It also adds any missing entries to go.sum and removes unnecessary entries.
3. go mod vendor  </p></blockquote><blockquote><p>The go mod vendor command constructs a directory named vendor in the main moduleâ€™s root directory that contains copies of all packages needed to support builds and tests of packages in the main module.
4. go test (test the code can run correctly when depending on the modules in go.mod or not)</p></blockquote><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="how-to-update-dependency"></a>How to update dependency<a class="hash-link" href="#how-to-update-dependency" title="Direct link to heading">#</a></h4><p>If you need a new feature from a new version of module A, you need to do the following:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">cd &lt;your project root path&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">go get &lt;module A&gt;@&lt;new feature branch&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">go mod vendor</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="how--to-know-why-a-module-or-a-package-is-required-by"></a>How  to know why a module or a package is required by<a class="hash-link" href="#how--to-know-why-a-module-or-a-package-is-required-by" title="Direct link to heading">#</a></h4><p><strong>go mod why</strong> can help you to see why your module requires a certain module or package.
For example, you need to know why git.garena.com/common/gocommon is required by your module, you can run <strong>go mod why -m git.garena.com/common/gocommon</strong> then a shortest dependency path from your module to gocommon will be printed.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="advices"></a>Advices<a class="hash-link" href="#advices" title="Direct link to heading">#</a></h4><ol><li>As a maintainer, keep backward compatibility as much as you can. <a href="https://blog.golang.org/module-compatibility" target="_blank" rel="noopener noreferrer">https://blog.golang.org/module-compatibility</a></li><li>Use the same version of a certain module if it&#x27;s possible for all of your modules.</li></ol></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><a class="margin-horiz--sm" href="/tags/golang">Golang</a><a class="margin-horiz--sm" href="/tags/go-module">go module</a></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/page/2"><div class="pagination-nav__label">Older Entries Â»</div></a></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b919a8d1.js"></script>
<script src="/assets/js/main.35894529.js"></script>
</body>
</html>